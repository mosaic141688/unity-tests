"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const any_1 = require("./any");
const parser_1 = require("../expression/parser");
const list_1 = require("../values/list");
const record_1 = require("../values/record");
function groupTransform(value_type, options) {
    const expression = any_1.expectExpression(options);
    const { input_type, output_type } = any_1.matchTypes(value_type, '[{a}]', '{b}');
    const section_deps = any_1.extractDeps(options);
    function transform(input, deps) {
        const new_content = input.content.groupBy(element => {
            const local_deps = Object.assign({ '$element': element }, deps);
            const local_expression = parser_1.resolve_local(local_deps, expression);
            return parser_1.evaluate(local_expression).content;
        }).map(entry => new list_1.default({ type: '[{a}]', content: entry.toList() })).toMap();
        return new record_1.default({ type: '{b}', content: new_content });
    }
    return {
        input_type,
        output_type,
        deps: section_deps,
        transform
    };
}
exports.default = groupTransform;
//# sourceMappingURL=group.js.map